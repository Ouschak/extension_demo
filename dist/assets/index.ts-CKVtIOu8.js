(function(){let d=[];const c="user_blocklist";async function E(o){await T(),chrome.storage.onChanged.addListener(e=>{e[c]&&(x(e[c].newValue),o&&o())})}function C(o){if(d.length===0)return!1;const e=o.toLowerCase().trim().replace(/\s+/g," ");return console.log(`[CreatorShield] Checking text: "${e}" against ${d.length} patterns`),d.some(n=>{const a=n.test(e);return a&&console.log(`[CreatorShield] Matched user blocklist: "${e}" with pattern ${n}`),a})}function T(){return new Promise(o=>{chrome.storage.local.get(c,e=>{e[c]?(console.log("[CreatorShield] Loaded blocklist from storage:",e[c]),x(e[c])):console.log("[CreatorShield] No blocklist found in storage"),o()})})}function x(o){if(!o||!Array.isArray(o)){d=[];return}d=o.filter(e=>typeof e=="string"&&e.trim().length>0).map(A),console.log(`[CreatorShield] Updated user blocklist: ${d.length} patterns`)}function A(o){const t=o.toLowerCase().trim().replace(/\s+/g," ").replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=new RegExp(`(^|[^\\p{L}\\p{N}])${t}($|[^\\p{L}\\p{N}])`,"u");return console.log(`[CreatorShield] Created regex for "${o}":`,n),n}const m={commentText:'[data-testid="post-comment-text-content"]',testing:'ul ul span[dir="auto"]',commentReels:"div.x1cy8zhl.x1oa3qoh.x1nhvcw1"},L='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>',R='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm-1-11v6h2v-6h-2zm0-4v2h2V7h-2z"/></svg>',j={USER_FILTER:"Hidden by your preferences",PATTERN_MATCH:"Hidden due to harmful language",AI_DECISION:"Hidden due to potentially harmful content detected by AI",SOFT_HARASSMENT:"Hidden due to potentially negative comment detected by AI"},$=["2g1c","2 girls 1 cup","acrotomophilia","alabama hot pocket","alaskan pipeline","anal","anilingus","anus","apeshit","arsehole","ass","asshole","assmunch","auto erotic","autoerotic","babeland","baby batter","baby juice","ball gag","ball gravy","ball kicking","ball licking","ball sack","ball sucking","bangbros","bangbus","bareback","barely legal","barenaked","bastard","bastardo","bastinado","bbw","bdsm","beaner","beaners","beaver cleaver","beaver lips","beastiality","bestiality","big black","big breasts","big knockers","big tits","bimbos","birdlock","bitch","bitches","black cock","blonde action","blonde on blonde action","blowjob","blow job","blow your load","blue waffle","blumpkin","bollocks","bondage","boner","boob","boobs","booty call","brown showers","brunette action","bukkake","bulldyke","bullet vibe","bullshit","bung hole","bunghole","busty","butt","buttcheeks","butthole","camel toe","camgirl","camslut","camwhore","carpet muncher","carpetmuncher","chocolate rosebuds","cialis","circlejerk","cleveland steamer","clit","clitoris","clover clamps","clusterfuck","cock","cocks","coprolagnia","coprophilia","cornhole","coon","coons","creampie","cum","cumming","cumshot","cumshots","cunnilingus","cunt","darkie","date rape","daterape","deep throat","deepthroat","dendrophilia","dick","dildo","dingleberry","dingleberries","dirty pillows","dirty sanchez","doggie style","doggiestyle","doggy style","doggystyle","dog style","dolcett","domination","dominatrix","dommes","donkey punch","double dong","double penetration","dp action","dry hump","dvda","eat my ass","ecchi","ejaculation","erotic","erotism","escort","eunuch","fag","faggot","fecal","felch","fellatio","feltch","female squirting","femdom","figging","fingerbang","fingering","fisting","foot fetish","footjob","frotting","fuck","fuck buttons","fuckin","fucking","fucktards","fudge packer","fudgepacker","futanari","gangbang","gang bang","gay sex","genitals","giant cock","girl on","girl on top","girls gone wild","goatcx","goatse","god damn","gokkun","golden shower","goodpoop","goo girl","goregasm","grope","group sex","g-spot","guro","hand job","handjob","hard core","hardcore","hentai","homoerotic","honkey","hooker","horny","hot carl","hot chick","how to kill","how to murder","huge fat","humping","incest","intercourse","jack off","jail bait","jailbait","jelly donut","jerk off","jigaboo","jiggaboo","jiggerboo","jizz","juggs","kike","kinbaku","kinkster","kinky","knobbing","leather restraint","leather straight jacket","lemon party","livesex","lolita","lovemaking","make me come","male squirting","masturbate","masturbating","masturbation","menage a trois","milf","missionary position","mong","motherfucker","mound of venus","mr hands","muff diver","muffdiving","nambla","nawashi","negro","neonazi","nigga","nigger","nig nog","nimphomania","nipple","nipples","nsfw","nsfw images","nude","nudity","nutten","nympho","nymphomania","octopussy","omorashi","one cup two girls","one guy one jar","orgasm","orgy","paedophile","paki","panties","panty","pedobear","pedophile","pegging","penis","phone sex","piece of shit","pikey","pissing","piss pig","pisspig","playboy","pleasure chest","pole smoker","ponyplay","poof","poon","poontang","punany","poop chute","poopchute","porn","porno","pornography","prince albert piercing","pthc","pubes","pussy","queaf","queef","quim","raghead","raging boner","rape","raping","rapist","rectum","reverse cowgirl","rimjob","rimming","rosy palm","rosy palm and her 5 sisters","rusty trombone","sadism","santorum","scat","schlong","scissoring","semen","sex","sexcam","sexo","sexy","sexual","sexually","sexuality","shaved beaver","shaved pussy","shemale","shibari","shit","shitblimp","shitty","shota","shrimping","skeet","slanteye","slut","s&m","smut","snatch","snowballing","sodomize","sodomy","spastic","spic","splooge","splooge moose","spooge","spread legs","spunk","strap on","strapon","strappado","strip club","style doggy","suck","sucks","suicide girls","sultry women","swastika","swinger","tainted love","taste my","tea bagging","threesome","throating","thumbzilla","tied up","tight white","tit","tits","titties","titty","tongue in a","topless","tosser","towelhead","tranny","tribadism","tub girl","tubgirl","tushy","twat","twink","twinkie","two girls one cup","undressing","upskirt","urethra play","urophilia","vagina","venus mound","viagra","vibrator","violet wand","vorarephilia","voyeur","voyeurweb","voyuer","vulva","wank","wetback","wet dream","white power","whore","worldsex","wrapping men","wrinkled starfish","xx","xxx","yaoi","yellow showers","yiffy","zoophilia"];function N(o){return o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function O(o){const e=o.toLowerCase();for(const t of $)if(new RegExp(`\\b${N(t)}\\b`,"i").test(e))return console.log(`[TIER 1] Pattern matched: "${t}"`),!0;return!1}async function S(o,e){if(!(!o||o.length<3))try{const n=(await chrome.storage.local.get("socialshield-feedback-queue"))["socialshield-feedback-queue"]||[];if(n.some(r=>r.text===o))return;const i={id:`detect-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,text:o,wasBlocked:e,timestamp:Date.now(),platform:"instagram"};n.push(i);const s=n.slice(-50);await chrome.storage.local.set({"socialshield-feedback-queue":s}),console.log("[SocialShield] Saved comment for feedback:",e?"blocked":"allowed")}catch(t){console.error("[SocialShield] Error saving feedback item:",t)}}let b=new WeakSet,l=!0,p=!1;function y(){console.log("[SocialShield] updateEnabledState called"),chrome.storage.local.get("socialshield-detection-store",o=>{if(console.log("[SocialShield] Storage result:",o),o["socialshield-detection-store"])try{const e=o["socialshield-detection-store"];console.log("[SocialShield] Raw state:",e);const t=JSON.parse(e).state,n=(t==null?void 0:t.enabled)??!0,a=(t==null?void 0:t.softHarassmentEnabled)??!1;console.log(`[SocialShield] STATE UPDATE: Enabled=${n}, SoftHarassment=${a}`);let i=!1;l!==n&&(console.log(`[SocialShield] ðŸš¨ GLOBAL ENABLE TOGGLED: ${l} -> ${n}`),l=n,l?i=!0:w()),p!==a&&(console.log(`[SocialShield] ðŸš¨ SOFT HARASSMENT TOGGLED: ${p} -> ${a}`),p=a,l&&(i=!0)),i?(console.log("[SocialShield] ðŸ”„ State changed, triggering FORCE RESCAN..."),v()):console.log("[SocialShield] No rescan needed.")}catch(e){console.error("[SocialShield] Error parsing state:",e)}})}function z(){console.log("[SocialShield] Enabling protection - Re-scanning"),document.body.classList.remove("cs-protection-disabled"),b=new WeakSet,document.querySelectorAll(Object.values(m).join(", ")).forEach(e=>f(e))}function w(){console.log("[SocialShield] Disabling protection - Cleaning up"),document.body.classList.add("cs-protection-disabled"),document.querySelectorAll(".cs-toxic-overlay").forEach(o=>o.remove()),document.querySelectorAll('[data-toxic="true"]').forEach(o=>{const e=o;e.style.filter="",e.style.transition="",delete e.dataset.toxic}),document.querySelectorAll(".cs-flag-btn").forEach(o=>o.remove())}let u=null;function H(){y(),chrome.storage.onChanged.addListener((o,e)=>{console.log("[SocialShield] Storage changed in area:",e,o),o["socialshield-detection-store"]&&y()}),u=new MutationObserver(I),u.observe(document.body,{childList:!0,subtree:!0}),console.log("[SocialShield] Observer active")}function v(){l&&(w(),z())}async function I(o){if(l)for(const e of o)for(const t of e.addedNodes)t instanceof HTMLElement&&(t.querySelectorAll(Object.values(m).join(", ")).forEach(a=>f(a)),t.matches(Object.values(m).join(", "))&&f(t))}async function f(o){var n;if(b.has(o))return;b.add(o);const e=(n=o.textContent)==null?void 0:n.trim();if(!e||e.length<1||o.closest("a")||o.querySelector('a[href*="/explore/locations/"]')||e==="SponsorisÃ©"||e==="Sponsored"||e==="Audio dâ€™origine"||e==="Report a problem"||e==="Switch accounts"||e==="Log out"||e==="Switch appearance"||e.includes("Suggested for you")||e.includes("Suggestions pour vous")||e.includes("Suggestions")||e.includes("Followed by")||e.includes("VerifiedPopular")||e.includes("DÃ©connexion")||e.includes("Changer de compte")||e.includes("Signaler un problÃ¨me")||e.includes("Changer lâ€™apparence")||e.includes("lina")||e.includes("Changer lâ€™apparence")||e.includes("Suivi(e) par")||e.includes("hours ago")||e.includes("minutes ago")||e.includes("Meta Verified")||e.startsWith("AboutHelpPressAPI")||e.startsWith("Liked by ")||e.includes("Populaire")||/^[\d,.]+[km]?\s*likes?$/i.test(e)||e.includes("chakouss")||e.includes("azrorganizationandsportsazr")||e.includes("profile picture")||e.includes("photo de profil")||e.toLowerCase().includes("suivi"))return;const t=o.parentElement;if(t)try{if(t.style.position="relative",C(e)){console.log(`[TIER 0] Blocked by user preference: "${e}"`),h(o,t,"USER_FILTER");return}const a=O(e);a&&console.log(`[TIER 1] Pattern matched: "${e}"`);const i={text:e,checkSoftHarassment:p};a?(console.log(`ðŸ”´ [PATTERN BLOCKED] "${e}"`),h(o,t,"PATTERN_MATCH"),chrome.runtime.sendMessage({type:"ANALYZE_TEXT",payload:i},s=>{if(s&&!s.is_toxic){console.log("[UN-HIDE] Backend cleared pattern match"),o.style.filter="none";const r=t.querySelector(".cs-toxic-overlay");r&&r.remove()}})):chrome.runtime.sendMessage({type:"ANALYZE_TEXT",payload:i},s=>{var r;if(chrome.runtime.lastError){(r=chrome.runtime.lastError.message)!=null&&r.includes("invalidated")&&(u==null||u.disconnect());return}if(s)if(s.is_toxic){const g=s.label==="harassment"?"SOFT_HARASSMENT":"AI_DECISION";h(o,t,g)}else M(o,t,e)})}catch(a){console.error(a)}}function h(o,e,t){var g;o.style.filter="blur(6px)",o.style.transition="filter 0.3s",o.dataset.toxic="true",o.dataset.hideReason=t;const n=((g=o.textContent)==null?void 0:g.trim())||"";S(n,!0);const a=document.createElement("div");a.className="cs-toxic-overlay",a.style.cssText=`
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        display: flex; align-items: center; justify-content: center; gap: 8px;
        background: transparent; z-index: 10000;
        border-radius: 4px;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
    `,e.addEventListener("mouseenter",()=>a.style.opacity="1"),e.addEventListener("mouseleave",()=>a.style.opacity="0");const i=document.createElement("button");i.innerHTML=`${R} Why?`,i.style.cssText=`
        display: flex; align-items: center; gap: 4px; border: 1px solid rgba(255,255,255,0.2); 
        background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.2); padding: 4px 10px; border-radius: 12px;
        font-size: 11px; font-weight: 500; cursor: pointer; color: #9ca3af;
        transition: background 0.2s;
    `,i.onmouseover=()=>i.style.background="rgba(0, 0, 0, 0.8)",i.onmouseout=()=>i.style.background="rgba(0, 0, 0, 0.6)";const s=document.createElement("div");s.style.cssText=`
        display: none; width: 100%; text-align: center;
        color: #ffffff; font-size: 11px; margin-top: 6px; font-weight: 600;
        text-shadow: 0 1px 4px rgba(0,0,0,0.9);
        background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 4px;
        backdrop-filter: blur(4px);
        pointer-events: none;
        position: relative; z-index: 10001;
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    `,s.innerText=j[t],i.onclick=()=>{s.style.display==="none"?(s.style.display="block",i.style.background="rgba(255, 255, 255, 0.1)"):(s.style.display="none",i.style.background="rgba(0, 0, 0, 0.6)")};const r=document.createElement("div");r.style.cssText="display: flex; flex-direction: column; align-items: center;",r.appendChild(i),r.appendChild(s),a.appendChild(r),e.appendChild(a)}function M(o,e,t){S(t,!1);const n=document.createElement("button");n.className="cs-flag-btn",n.innerHTML=L,n.title="Report as Toxic",n.style.cssText=`
        opacity: 0; transition: opacity 0.2s; border: none; background: none; 
        cursor: pointer; color: #9ca3af; margin-left: 8px; vertical-align: middle;
    `,e.addEventListener("mouseenter",()=>n.style.opacity="1"),e.addEventListener("mouseleave",()=>n.style.opacity="0"),n.onclick=a=>{a.stopPropagation(),confirm("Report this comment as toxic?")&&(_(t,"toxic"),n.style.color="#ef4444",o.style.filter="blur(2px)")},e.appendChild(n)}function _(o,e){chrome.runtime.sendMessage({type:"SEND_FEEDBACK",payload:{content:o,platform:"instagram",correction:e}})}async function k(){console.log("[CreatorShield] v2.1.0 - Clean Boot"),document.querySelectorAll(".cs-toxic-overlay").forEach(o=>o.remove()),await E(()=>{console.log("[CreatorShield] Blocklist updated, triggering re-scan"),v()}),H()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();
})()
