(function(){const u={commentText:'[data-testid="post-comment-text-content"]',commentAlt:'ul ul span[dir="auto"]',caption:'h1[dir="auto"]'},p=new WeakSet,x='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8zm0 2c-4.42 0-8 2.69-8 6 0 1.55.6 2.97 1.62 4.09l.33.37-.15.48c-.06.2-.18.73-.55 1.54 1.29-.27 2.19-.88 2.68-1.55l.24-.33.38.12c1.02.32 2.13.48 3.25.48 4.42 0 8-2.69 8-6s-3.58-6-8-6zm0 4c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2z"/></svg>',m='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="14" height="14"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>';let l=!0;function f(){chrome.storage.local.get("creator-shield-detection-store",e=>{if(e["creator-shield-detection-store"])try{const o=JSON.parse(e["creator-shield-detection-store"]).state;l=(o==null?void 0:o.enabled)??!0,console.log("[CreatorShield] Enabled state:",l)}catch(o){console.error(o)}})}let c=null;function b(){f(),chrome.storage.onChanged.addListener(e=>{e["creator-shield-detection-store"]&&f()}),c=new MutationObserver(v),c.observe(document.body,{childList:!0,subtree:!0}),console.log("[CreatorShield] Observer active")}async function v(e){if(l)for(const o of e)for(const n of o.addedNodes)n instanceof HTMLElement&&(n.querySelectorAll(Object.values(u).join(", ")).forEach(i=>h(i)),n.matches(Object.values(u).join(", "))&&h(n))}async function h(e){var a;if(p.has(e))return;p.add(e);const o=(a=e.textContent)==null?void 0:a.trim();if(!o||o.length<3)return;const n=e.parentElement;if(n)try{n.style.position="relative",chrome.runtime.sendMessage({type:"ANALYZE_TEXT",payload:{text:o}},i=>{var d;if(chrome.runtime.lastError){(d=chrome.runtime.lastError.message)!=null&&d.includes("invalidated")&&(c==null||c.disconnect());return}if(i)if(i.is_toxic){e.style.filter="blur(6px)",e.style.transition="filter 0.3s",e.dataset.toxic="true";const t=document.createElement("div");t.className="cs-toxic-overlay",t.style.cssText=`
                    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
                    display: flex; align-items: center; justify-content: center; gap: 8px;
                    background: rgba(255, 255, 255, 0.8); z-index: 10;
                    border-radius: 4px;
                `;const r=document.createElement("button");r.innerHTML=`${x} Show`,r.style.cssText=`
                    display: flex; align-items: center; gap: 4px; border: none; background: white; 
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 4px 8px; border-radius: 12px;
                    font-size: 11px; font-weight: 600; cursor: pointer; color: #333;
                `,r.onclick=()=>{e.style.filter="none",t.style.display="none"};const s=document.createElement("button");s.innerHTML=`${m} Report Safe`,s.style.cssText=r.style.cssText,s.style.color="#ef4444",s.onclick=()=>{g(o,"safe"),s.innerHTML="Reported",s.disabled=!0},t.appendChild(r),t.appendChild(s),n.appendChild(t)}else{const t=document.createElement("button");t.className="cs-flag-btn",t.innerHTML=m,t.title="Report as Toxic",t.style.cssText=`
                    opacity: 0; transition: opacity 0.2s; border: none; background: none; 
                    cursor: pointer; color: #9ca3af; margin-left: 8px; vertical-align: middle;
                `,n.addEventListener("mouseenter",()=>t.style.opacity="1"),n.addEventListener("mouseleave",()=>t.style.opacity="0"),t.onclick=r=>{r.stopPropagation(),confirm("Report this comment as toxic?")&&(g(o,"toxic"),t.style.color="#ef4444",e.style.filter="blur(2px)")},n.appendChild(t)}})}catch(i){console.error(i)}}function g(e,o){chrome.runtime.sendMessage({type:"SEND_FEEDBACK",payload:{content:e,platform:"instagram",correction:o}})}function y(){console.log("[CreatorShield] Content script loaded on:",window.location.href),b()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();
})()
